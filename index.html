<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ChromaLex Studio</title>
    
    <meta name="theme-color" content="#050505">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="ChromaLex">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="manifest" href="manifest.json">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Cinzel:wght@400;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Lato:wght@300;400&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
</head>

<body class="dark bg-black text-gray-200">

    <div id="drawerOverlay" onclick="toggleDrawer()"></div>

    <div id="sidebar">
        <div class="p-6 flex justify-between items-center border-b border-gold-dim">
            <h1 class="text-2xl tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 via-yellow-400 to-yellow-600 font-serif">CHROMALEX</h1>
            <button onclick="toggleDrawer()" class="text-gray-500 hover:text-white">‚úï</button>
        </div>

        <div class="px-4 py-4">
            <input type="text" id="bookTitle" value="Ephemeral Echoes" class="w-full bg-black/50 text-sm p-3 rounded-lg border border-gray-800 focus:border-yellow-500 text-gray-300 placeholder-gray-600 outline-none" placeholder="Project Title">
        </div>

        <nav id="mainNav" class="flex-grow px-4 space-y-2 overflow-y-auto custom-scrollbar">
            <div class="text-[10px] font-bold uppercase tracking-widest text-gray-500 mt-2 mb-1">Creation</div>
            <button data-tab-id="write" onclick="toggleDrawer(); switchTab('write')" class="tab-btn w-full text-left p-3 rounded-xl flex items-center gap-3 glass-button">
                <span>‚úçÔ∏è</span> <span>Writing Studio</span>
            </button>
            <button data-tab-id="brainstorm" onclick="toggleDrawer(); switchTab('brainstorm')" class="tab-btn w-full text-left p-3 rounded-xl flex items-center gap-3 glass-button">
                <span>üí°</span> <span>Idea Canvas</span>
            </button>
            <button data-tab-id="research" onclick="toggleDrawer(); switchTab('research')" class="tab-btn w-full text-left p-3 rounded-xl flex items-center gap-3 glass-button">
                <span>üîç</span> <span>Research Library</span>
            </button>

            <div class="text-[10px] font-bold uppercase tracking-widest text-gray-500 mt-4 mb-1">Production</div>
            <button data-tab-id="compile" onclick="toggleDrawer(); switchTab('compile')" class="tab-btn w-full text-left p-3 rounded-xl flex items-center gap-3 glass-button">
                <span>üèóÔ∏è</span> <span>Architect</span>
            </button>
            <button data-tab-id="design" onclick="toggleDrawer(); switchTab('design')" class="tab-btn w-full text-left p-3 rounded-xl flex items-center gap-3 glass-button">
                <span>üé®</span> <span>Typesetter</span>
            </button>
            
            <button onclick="toggleDrawer(); showSettingsModal()" class="tab-btn w-full text-left p-3 rounded-xl flex items-center gap-3 glass-button mt-4">
                <span>‚öôÔ∏è</span> <span>Settings</span>
            </button>
        </nav>
        
        <div class="p-4 border-t border-gold-dim">
            <div class="text-[10px] font-bold uppercase tracking-wider text-gray-500 mb-2">Recent Files</div>
            <div id="poemListContainer" class="space-y-1 overflow-y-auto max-h-32 custom-scrollbar"></div>
            <button onclick="createNewPoem()" class="w-full mt-3 py-2 border border-yellow-500/30 text-yellow-500 text-xs font-bold rounded-lg hover:bg-yellow-500 hover:text-black transition">
                + New Work
            </button>
        </div>
    </div>

    <div id="mainContent">
        
        <header class="h-16 flex items-center justify-between px-4 border-b border-gold-dim bg-black/20 backdrop-blur-md z-30 shrink-0">
            <div class="flex items-center gap-3">
                <button onclick="toggleDrawer()" class="p-2 text-gold hover:bg-white/10 rounded-lg transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
                <h2 id="currentTabTitle" class="text-lg font-bold text-gray-200 tracking-wide">Writing Studio</h2>
            </div>
            
            <div class="flex items-center gap-2">
                <button onclick="saveVersion()" class="glass-button px-3 py-1.5 rounded-lg text-xs font-bold tracking-wider uppercase">Save</button>
            </div>
        </header>

        <div class="flex-grow relative overflow-hidden">
            
            <div id="content-write" class="tab-content" style="display: block;">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 h-full">
                    
                    <div class="lg:col-span-3 glass-panel h-full relative flex flex-col">
                        <div class="p-4 border-b border-gold-dim flex items-center justify-between shrink-0">
                            <input type="text" id="poemTitle" value="Untitled" class="bg-transparent text-xl font-bold text-gray-100 placeholder-gray-600 focus:outline-none w-full border-none shadow-none p-0">
                            <button onclick="toggleZenMode()" class="text-gray-500 hover:text-gold" title="Zen Mode">üßò</button>
                        </div>
                        
                        <div class="flex-grow relative">
                            <textarea id="poemContent" class="absolute inset-0 w-full h-full p-6 custom-scrollbar text-lg leading-relaxed" placeholder="Start writing..."></textarea>
                        </div>

                        <div class="p-2 bg-black/40 border-t border-gold-dim flex justify-between text-xs text-gray-500 shrink-0">
                            <span>Words: <span id="wordCount" class="text-gold">0</span></span>
                            <span>Tone: <span id="predictedTone">--</span></span>
                        </div>
                    </div>

                    <div id="aiAssistantPalette" class="hidden lg:flex lg:col-span-1 glass-panel p-4 flex-col gap-4 overflow-y-auto custom-scrollbar">
                         <h4 class="font-bold text-gold text-sm uppercase tracking-widest border-b border-gold-dim pb-2">Analysis</h4>
                         <div class="space-y-2 text-sm text-gray-400">
                             <div class="flex justify-between"><span>Lines</span><span id="lineCount" class="text-gray-200">0</span></div>
                             <div class="flex justify-between"><span>Avg Syllables</span><span id="avgSyllables" class="text-gray-200">0</span></div>
                         </div>
                         
                         <h4 class="font-bold text-gold text-sm uppercase tracking-widest border-b border-gold-dim pb-2 mt-4">Linked Research</h4>
                         <div id="linkedResearch" class="text-xs space-y-2 text-gray-400"></div>
                    </div>
                </div>
            </div>

            <div id="content-compile" class="tab-content">
                <div class="glass-panel h-full flex flex-col p-4">
                    <div class="flex justify-between items-center mb-4 shrink-0">
                        <h3 class="text-xl font-bold text-gray-200">Structure</h3>
                        <button onclick="addStructureItem('section')" class="glass-button px-3 py-1 text-xs">+ Section</button>
                    </div>
                    <div id="architectList" class="flex-grow overflow-y-auto custom-scrollbar space-y-2 p-2 bg-black/20 rounded-lg"></div>
                    <div class="mt-4 pt-4 border-t border-gold-dim flex justify-end shrink-0">
                        <button onclick="generateFullManuscript()" class="glass-button px-6 py-2 text-sm font-bold text-gold border-gold-dim hover:bg-yellow-500/10">Export .TXT</button>
                    </div>
                </div>
            </div>

            <div id="content-design" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 h-full">
                    <div class="bg-black/40 rounded-xl overflow-hidden relative flex items-center justify-center border border-gold-dim">
                        <div id="bookPreviewPage" class="book-page-simulation paper-cream scale-75 lg:scale-90 origin-center transition-transform shadow-2xl">
                            <h2 id="previewHeader" class="text-3xl font-bold text-center mb-8 text-black">Title</h2>
                            <div id="previewBodyText" class="text-lg text-black">Content...</div>
                            <div id="previewDivider"></div>
                            <p class="text-center mt-12 opacity-50 text-black text-sm">1</p>
                        </div>
                    </div>
                    <div class="glass-panel p-6 overflow-y-auto custom-scrollbar">
                        <h3 class="text-lg font-bold text-gold mb-4">Typography</h3>
                        <div class="space-y-4">
                            <select id="headerFontSelect" onchange="updateDesign()" class="w-full p-2 bg-black/50 border border-gray-700 rounded text-gray-300"><option value="'Cinzel', serif">Cinzel</option><option value="'Playfair Display', serif">Playfair</option></select>
                            <select id="bodyFontSelect" onchange="updateDesign()" class="w-full p-2 bg-black/50 border border-gray-700 rounded text-gray-300"><option value="'Cormorant Garamond', serif">Cormorant</option><option value="'Lato', sans-serif">Lato</option></select>
                            <button onclick="generateStyledBook()" class="w-full py-3 mt-4 bg-yellow-600 text-black font-bold rounded hover:bg-yellow-500 transition">Export HTML Proof</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="content-brainstorm" class="tab-content"><div class="glass-panel h-full p-6"><h3 class="text-xl text-gold mb-4">Idea Canvas</h3><div id="ideasGrid" class="grid grid-cols-1 gap-4"></div></div></div>
            <div id="content-research" class="tab-content"><div class="glass-panel h-full p-6"><h3 class="text-xl text-gold mb-4">Research</h3><div id="researchLibraryContainer"></div></div></div>
        </div>
    </div>

    <button id="zenExitBtn" onclick="toggleZenMode()" class="hidden fixed top-4 right-4 z-[200] px-4 py-2 bg-black border border-gold-dim text-gold rounded-full shadow-2xl text-xs font-bold uppercase tracking-widest">Exit Zen</button>

    <div id="museMenu" class="hidden absolute glass-panel p-1 flex-row gap-1 z-[200] -translate-x-1/2 -translate-y-full">
        <button onclick="museAction('synonym')" class="px-3 py-1 text-xs text-purple-300 hover:bg-white/10 rounded">Synonym</button>
        <button onclick="museAction('capture')" class="px-3 py-1 text-xs text-green-300 hover:bg-white/10 rounded">Clip</button>
    </div>

    <div id="metadataModal" class="modal fixed inset-0 z-[300] hidden justify-center items-center"><div class="w-full max-w-lg p-6 glass-panel"><h3 class="text-xl text-gold mb-4">Metadata</h3><input id="metaAuthor" class="w-full mb-2 p-2 bg-black/50 border border-gray-700 rounded" placeholder="Author"><button onclick="saveMetadata()" class="w-full py-2 bg-green-700 text-white rounded">Save</button><button onclick="closeMetadataModal()" class="absolute top-4 right-4 text-gray-500">‚úï</button></div></div>
    <div id="settingsModal" class="modal fixed inset-0 z-[300] hidden justify-center items-center"><div class="w-full max-w-sm p-6 glass-panel"><h3 class="text-xl text-gold mb-4">Settings</h3><button onclick="closeSettingsModal()" class="w-full py-2 bg-gray-700 text-white rounded">Close</button></div></div>
    
    <div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 px-6 py-2 bg-black border border-gold-dim text-gold text-xs rounded-full shadow-xl z-[400] opacity-0 transition-opacity pointer-events-none"></div>

    <script>
        // Drawer Toggle Logic
        function toggleDrawer() {
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('drawerOverlay');
            sb.classList.toggle('open');
            ov.classList.toggle('active');
        }
        
        // Service Worker
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('/sw.js'); }); }
    </script>
    <script src="js/app.js"></script>
</body>
</html>
